<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Interface</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        button { margin: 5px; padding: 10px; }
    </style>
</head>
<body>
    <h1>Pathology Viewer Debug Interface</h1>
    
    <div class="test-section">
        <h3>API Tests</h3>
        <button onclick="testSlidesAPI()">Test Slides API</button>
        <button onclick="testConfigAPI()">Test Config API</button>
        <div id="api-results"></div>
    </div>
    
    <div class="test-section">
        <h3>DOM Tests</h3>
        <button onclick="testDOMElements()">Test DOM Elements</button>
        <div id="dom-results"></div>
    </div>
    
    <div class="test-section">
        <h3>Tab Tests</h3>
        <button class="tab-btn" data-tab="system">System Tab</button>
        <button class="tab-btn" data-tab="vips">VIPS Tab</button>
        <button onclick="testTabSwitching()">Test Tab Switching</button>
        <div id="tab-results"></div>
    </div>
    
    <div class="test-section">
        <h3>Console Output</h3>
        <div id="console-output" style="background: #f0f0f0; padding: 10px; height: 200px; overflow-y: scroll;"></div>
    </div>

    <script>
        // Redirect console.log to our output div
        const consoleOutput = document.getElementById('console-output');
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            consoleOutput.innerHTML += '<div class="success">[LOG] ' + args.join(' ') + '</div>';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            consoleOutput.innerHTML += '<div class="error">[ERROR] ' + args.join(' ') + '</div>';
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        };
        
        async function testSlidesAPI() {
            const resultsDiv = document.getElementById('api-results');
            try {
                console.log('Testing slides API...');
                const response = await fetch('/api/slides');
                console.log('Slides API response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Slides API success! Found', data.length, 'slides');
                    resultsDiv.innerHTML = '<span class="success">✅ Slides API working - ' + data.length + ' slides found</span>';
                } else {
                    console.error('Slides API failed with status:', response.status);
                    resultsDiv.innerHTML = '<span class="error">❌ Slides API failed: ' + response.status + '</span>';
                }
            } catch (error) {
                console.error('Slides API error:', error);
                resultsDiv.innerHTML = '<span class="error">❌ Slides API error: ' + error.message + '</span>';
            }
        }
        
        async function testConfigAPI() {
            const resultsDiv = document.getElementById('api-results');
            try {
                console.log('Testing config API...');
                const response = await fetch('/api/pathology-config');
                console.log('Config API response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Config API success!');
                    resultsDiv.innerHTML += '<br><span class="success">✅ Config API working</span>';
                } else {
                    console.error('Config API failed with status:', response.status);
                    resultsDiv.innerHTML += '<br><span class="error">❌ Config API failed: ' + response.status + '</span>';
                }
            } catch (error) {
                console.error('Config API error:', error);
                resultsDiv.innerHTML += '<br><span class="error">❌ Config API error: ' + error.message + '</span>';
            }
        }
        
        function testDOMElements() {
            const resultsDiv = document.getElementById('dom-results');
            console.log('Testing DOM elements...');
            
            const elements = [
                'slidesGrid', 'deploymentMode', 'slidesDir', 'dziDir', 'tempDir',
                'vipsConcurrency', 'vipsQuality', 'saveConfigBtn'
            ];
            
            let results = '';
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    console.log('✅ Found element:', id);
                    results += '<span class="success">✅ ' + id + '</span><br>';
                } else {
                    console.error('❌ Missing element:', id);
                    results += '<span class="error">❌ ' + id + '</span><br>';
                }
            });
            
            resultsDiv.innerHTML = results;
        }
        
        function testTabSwitching() {
            const resultsDiv = document.getElementById('tab-results');
            console.log('Testing tab switching...');
            
            const tabBtns = document.querySelectorAll('.tab-btn');
            console.log('Found', tabBtns.length, 'tab buttons');
            
            if (tabBtns.length > 0) {
                tabBtns.forEach((btn, i) => {
                    const tabName = btn.getAttribute('data-tab');
                    console.log('Tab button', i, ':', tabName);
                    
                    btn.addEventListener('click', () => {
                        console.log('Tab clicked:', tabName);
                        resultsDiv.innerHTML = '<span class="success">✅ Tab clicked: ' + tabName + '</span>';
                    });
                });
                resultsDiv.innerHTML = '<span class="success">✅ Tab buttons set up</span>';
            } else {
                console.error('No tab buttons found');
                resultsDiv.innerHTML = '<span class="error">❌ No tab buttons found</span>';
            }
        }
        
        // Initialize
        console.log('Debug interface loaded');
        console.log('Current URL:', window.location.href);
        console.log('User agent:', navigator.userAgent);
    </script>
</body>
</html>
