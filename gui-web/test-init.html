<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Initialization Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1e1e1e; color: white; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #28a745; }
        .error { background: #dc3545; }
        .info { background: #17a2b8; }
        button { padding: 8px 16px; margin: 5px; background: #007acc; color: white; border: none; border-radius: 3px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>GUI Initialization Test</h1>
    
    <div>
        <button onclick="testInitialization()">Test Initialization</button>
        <button onclick="testElementsAccess()">Test Elements Access</button>
        <button onclick="clearResults()">Clear</button>
    </div>
    
    <div id="results"></div>

    <!-- Minimal DOM elements for testing -->
    <div style="display: none;">
        <div id="slidesGrid"></div>
        <div id="consoleOutput"></div>
        <input type="checkbox" id="autoScroll" checked>
        <button id="scanSlidesBtn">Scan</button>
        <button id="clearConsoleBtn">Clear</button>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            results.innerHTML += `<div class="test-result ${className}">${new Date().toLocaleTimeString()}: ${message}</div>`;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // Copy the essential functions from app.js for testing
        let elements = {};

        function initializeElements() {
            console.log('🎯 Initializing DOM elements...');
            elements = {
                slidesGrid: document.getElementById('slidesGrid'),
                consoleOutput: document.getElementById('consoleOutput'),
                autoScroll: document.getElementById('autoScroll'),
                scanSlidesBtn: document.getElementById('scanSlidesBtn'),
                clearConsoleBtn: document.getElementById('clearConsoleBtn'),
                // Add null elements to test null checking
                nonExistentElement: document.getElementById('doesNotExist')
            };
            console.log('🎯 DOM elements initialized. slidesGrid found:', !!elements.slidesGrid);
        }

        function setupEventListeners() {
            console.log('🎛️ Setting up event listeners...');
            
            // Test with existing elements
            if (elements.scanSlidesBtn) {
                elements.scanSlidesBtn.addEventListener('click', () => log('Scan button clicked!', 'success'));
            }
            
            if (elements.clearConsoleBtn) {
                elements.clearConsoleBtn.addEventListener('click', () => log('Clear button clicked!', 'success'));
            }
            
            // Test with non-existent elements (should not throw error)
            if (elements.nonExistentElement) {
                elements.nonExistentElement.addEventListener('click', () => {});
            }
            
            console.log('🎛️ Event listeners setup completed');
        }

        function appendToConsole(text, type = 'stdout') {
            if (!elements.consoleOutput) {
                console.log(`[Console] ${text}`);
                return;
            }
            
            const timestamp = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.className = `log-${type}`;
            line.textContent = `[${timestamp}] ${text}`;
            
            elements.consoleOutput.appendChild(line);
            
            // Auto-scroll if enabled
            if (elements.autoScroll && elements.autoScroll.checked) {
                elements.consoleOutput.scrollTop = elements.consoleOutput.scrollHeight;
            }
        }

        async function testInitialization() {
            try {
                log('Starting initialization test...', 'info');
                
                // Test DOM element initialization
                initializeElements();
                log('✅ DOM elements initialized successfully', 'success');
                
                // Test event listeners setup
                setupEventListeners();
                log('✅ Event listeners setup successfully', 'success');
                
                // Test console function
                appendToConsole('Test console message', 'info');
                log('✅ Console function working', 'success');
                
                log('🎉 All initialization tests passed!', 'success');
                
            } catch (error) {
                log(`❌ Initialization failed: ${error.message}`, 'error');
                console.error('Initialization error:', error);
            }
        }

        function testElementsAccess() {
            try {
                log('Testing elements access...', 'info');
                
                // Test accessing existing elements
                if (elements.slidesGrid) {
                    log('✅ slidesGrid accessible', 'success');
                } else {
                    log('❌ slidesGrid not found', 'error');
                }
                
                if (elements.consoleOutput) {
                    log('✅ consoleOutput accessible', 'success');
                } else {
                    log('❌ consoleOutput not found', 'error');
                }
                
                // Test accessing non-existent elements (should not throw error)
                if (elements.nonExistentElement) {
                    log('❌ Non-existent element should be null', 'error');
                } else {
                    log('✅ Non-existent element correctly null', 'success');
                }
                
                log('🎉 Elements access test completed!', 'success');
                
            } catch (error) {
                log(`❌ Elements access failed: ${error.message}`, 'error');
                console.error('Elements access error:', error);
            }
        }

        // Auto-run test on page load
        window.addEventListener('DOMContentLoaded', () => {
            log('Page loaded, running initialization test...', 'info');
            setTimeout(testInitialization, 500);
        });
    </script>
</body>
</html>
